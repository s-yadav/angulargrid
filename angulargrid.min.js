/*
    angularGrid.js v 0.1.2
    Author: Sudhanshu Yadav
    Copyright (c) 2015 Sudhanshu Yadav - ignitersworld.com , released under the MIT license.
    Demo on: http://ignitersworld.com/lab/angulargrid/demo1.html
    Documentation and download on https://github.com/s-yadav/angulargrid 
*/

;!function(t,a){function n(t){return t.complete&&("undefined"==typeof t.naturalWidth||0!==t.naturalWidth)}function i(t){return Array.prototype.slice.call(t)}var e={gridWidth:300,gutterSize:10,refreshOnImgLoad:!0},r=function(){var n=t.element(a);return function(t){return n[0]=t,n}}();t.element(document.head).append("<style>.ag-no-transition{-webkit-transition: none !important;transition: none !important; visibility:hidden; opacity:0;}</style>"),t.module("angularGrid",[]).directive("angularGrid",["$timeout","$window","$q","angularGridInstance",function(a,d,o,l){return{restrict:"A",link:function(s,g,u){function h(){var t=w.offsetWidth;v=Math.floor(t/(I.gridWidth+I.gutterSize));var a=t%(I.gridWidth+I.gutterSize)+I.gutterSize;C=I.gridWidth+Math.floor(a/v),m.css({width:C+"px",height:"auto"}),S.length=0;for(var n=0;v>n;n++)S.push(0);return C}function c(){var a,n,e=h();i(m.find("img")).forEach(function(a){var n=t.element(a);if(n.hasClass("img-loaded"))return void n.css("height","");var i,e=n.attr("actual-width")||n.attr("data-actual-width"),r=n.attr("actual-height")||n.attr("data-actual-height");e&&r&&(i=a.width,u=r*i/e,n.css("height",u+"px"))});var d,o,l,s=[];for(a=0,n=m.length;n>a;a++)d=m[a],o=r(d),l=o.clone(),l.addClass("ag-no-transition"),l.css("width",e+"px"),o.after(l),s.push(l[0].offsetHeight),l.remove();for(a=0,n=m.length;n>a;a++){d=r(m[a]);var u=s[a],c=Math.min.apply(Math,S),f=S.indexOf(c);S[f]=c+u+I.gutterSize;var p=f*(e+I.gutterSize);d.css({top:c+"px",left:p+"px"})}g.css("height",Math.max.apply(Math,S)+"px")}function f(){var e=!1;i(m).forEach(function(r){var d=t.element(r),l=d.find("img"),s=[];l.length&&(d.addClass("img-loading"),i(l).forEach(function(i){var r=t.element(i);n(i)?r.addClass("img-loaded"):s.push(o(function(t,n){r.addClass("img-loading"),i.onload=function(){!e&&I.refreshOnImgLoad&&(e=!0,a(function(){c(),e=!1},100)),r.removeClass("img-loading").addClass("img-loaded"),t()},i.onerror=n}))}),s.length?o.all(s).then(function(){d.removeClass("img-loading").addClass("img-loaded")},function(){d.removeClass("img-loading").addClass("img-loaded")}):d.removeClass("img-loading").addClass("img-loaded"))})}var m,p,v,C,w=g[0],z=t.element(d),W=u.angularGridId,y=u.angularGrid,S=[],I={gridWidth:u.gridWidth?parseInt(u.gridWidth):e.gridWidth,gutterSize:u.gutterSize?parseInt(u.gutterSize):e.gutterSize,refreshOnImgLoad:"false"==u.refreshOnImgLoad?!1:!0};s.$watch(y,function(){a(function(){m=g.children(),c(),f(),a(function(){g.addClass("angular-grid"),c()})})},!0),z.on("resize",function(){p&&a.cancel(p),p=a(function(){c()},100)}),W&&(l[W]={refresh:c})}}}]).factory("angularGridInstance",function(){var t={};return t})}(angular,window);