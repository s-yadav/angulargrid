!function(o,t){"undefined"!=typeof module&&module.exports?module.exports=t(require("angular"),o):"function"==typeof define&&define.amd?define(["angular"],function(n){return t(n,o)}):t(o.angular,o)}(this,function(o,t,n){"use strict";var e,i={gridWidth:300,gutterSize:10,gridNo:"auto",direction:"ltor",refreshOnImgLoad:!0,cssGrid:!1,keepSort:!1,performantScroll:!1,pageSize:"auto",scrollContainer:"body",infiniteScrollDelay:3e3,infiniteScrollDistance:100},r=o.element,a=function(o){return o.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},l={visibility:"hidden",opacity:0,top:0,left:0,width:""},s=(e=r(t),function(o){return e[0]=o,e});function d(o){return Array.prototype.slice.call(o)}return r(document.head).append("<style>.ag-no-transition{-webkit-transition: none !important;transition: none !important;} .angular-grid{position : relative;} .angular-grid > *{opacity : 0} .angular-grid > .angular-grid-item{opacity : 1}</style>"),o.module("angularGrid",[]).directive("angularGrid",["$timeout","$window","$q","angularGridInstance",function(e,c,f,g){return{restrict:"A",scope:{model:"=angularGrid",dep_gridWidth:"=gridWidth",dep_gutterSize:"=gutterSize",dep_refreshOnImgLoad:"=refreshOnImgLoad",dep_direction:"=direction",dep_cssGrid:"=cssGrid",dep_options:"=angularGridOptions",dep_gridNo:"=gridNo",dep_agId:"@angularGridId",agId:"@",cssGrid:"=agCssGrid",direction:"=agDirection",gridNo:"=agGridNo",gridWidth:"=agGridWidth",gutterSize:"=agGutterSize",infiniteScroll:"&agInfiniteScroll",infiniteScrollDelay:"=agInfiniteScrollDelay",infiniteScrollDistance:"=agInfiniteScrollDistance",keepSort:"=agKeepSort",options:"=agOptions",pageSize:"=agPageSize",performantScroll:"=agPerformantScroll",refreshOnImgLoad:"=agRefreshOnImgLoad",scrollContainer:"@agScrollContainer"},link:function(u,h,p){var m,S,v,I=h[0],C=r(c),y=u.agId||u.dep_agId,$=0;function z(){v={},Object.keys(i).forEach(function(o){u[o]!==n?v[o]=u[o]:u["dep_"+o]!==n&&(v[o]=u["dep_"+o])}),(v=o.extend({},i,v,u.options||u.dep_options)).cssGrid&&(v.gutterSize=0),"auto"==v.pageSize&&(v.pageSize=t.offsetWidth>=768?2:3)}h.addClass("angular-grid"),["gridWidth","gutterSize","refreshOnImgLoad","direction","options","cssGrid","gridNo","agId"].forEach(function(o){var t=a(o),e="ag-"+a(o);"options"==o&&(t="angular-grid-options"),"agId"==o&&(t="angular-grid-id",e="ag-id"),u["dep_"+o]!==n&&console&&console.warn&&console.warn(t+" is deprecated. Use "+e+" instead in template.")}),z();var w={};function L(){var o=r(document.querySelector(v.scrollContainer)),t=o[0],n="body"===v.scrollContainer?C:o;return{height:n[0].innerHeight||n[0].offsetHeight,scrollHeight:t.scrollHeight,startFrom:function(o,t){t=t||document.body;var n=0,e=0;if(o.offsetParent)do{n+=o.offsetLeft,e+=o.offsetTop,o=o.offsetParent}while(o&&o!=t);return{left:n,top:e}}(I,t).top,$elm:n}}function G(o){var t;if(w.lastScrollPosition=o,!w.isBusy){var n=0,e=v.pageSize;if(o>w.scrollContInfo.startFrom+w.scrollContInfo.height*e&&(n=Math.floor((o-w.scrollContInfo.startFrom)/(w.scrollContInfo.height*e))),n!=w.lastPage){w.lastPage=n;var i=w.pageInfo[n];i&&(h.children().detach(),function(o){var t,n,e,i;for(e=0,i=m.length;e<i;e++)(t=(n=s(m[e])).data()).$scope&&(n.data("_agOldWatchers",t.$scope.$$watchers),t.$scope.$$watchers=[]);for(e=0,i=o.length;e<i;e++)(t=s(o[e]).data()).$scope&&(t.$scope.$$watchers=t._agOldWatchers||[],t.$scope.$digest())}(t=Array.prototype.slice.call(m,i.from,i.to+1)),h.append(t))}}}function x(){clearTimeout(w.infiniteScrollTimeout),w.isLoading=!1}function W(o){!w.isLoading&&u.model.length&&(o>=w.scrollContInfo.scrollHeight-w.scrollContInfo.height*(1+v.infiniteScrollDistance/100)&&(w.isLoading=!0,u.infiniteScroll(),w.infiniteScrollTimeout=setTimeout(x,v.infiniteScrollDelay)))}function _(){var o=this.scrollTop||this.scrollY;v.performantScroll&&G(o),u.infiniteScroll&&W(o)}function b(t,n){var e=n.beforeLoad||o.noop,i=n.onLoad||o.noop,r=n.isLoaded||o.noop,a=n.onFullLoad||o.noop,l=n.ignoreCheck||o.noop,s=[];d(t.find("img")).forEach(function(o){var t;o.src&&(e(o),(t=o).complete&&(void 0===t.naturalWidth||0!==t.naturalWidth)||l(o)?r(o):s.push(f(function(t,n){o.onload=function(){i(o),t()},o.onerror=n})))}),s.length?f.all(s).then(a,a):setTimeout(function(){a()},0)}function O(){if(m&&m.length){$++;var t,n=function(){var o,t=I.offsetWidth;if(v.cssGrid){(o=r(m[0]).clone()).css(l).addClass("ag-no-transition ag-clone"),h.append(o);var n=o[0].offsetWidth;return o.remove(),{no:n?Math.floor((t+12)/n):0,width:n}}var e="auto"==v.gridNo?v.gridWidth:Math.floor(t/v.gridNo)-v.gutterSize,i="auto"==v.gridNo?Math.floor((t+v.gutterSize)/(e+v.gutterSize)):v.gridNo,a=(t+v.gutterSize)%(e+v.gutterSize);return{no:i,width:e+=Math.floor(a/i)}}(),e=n.width,i=n.no;if(i){var a=[];for(t=0;t<i;t++)a.push(0);d(m).forEach(function(o){var t=s(o);d(t.find("img")).forEach(function(o){var n=r(o);if(n.hasClass("img-loaded"))n.css("height","");else{t.addClass("ag-no-transition"),t.css("width",e+"px");var i=n.attr("actual-width")||n.attr("data-actual-width"),a=n.attr("actual-height")||n.attr("data-actual-height");i&&a&&n.css("height",a*o.width/i+"px")}}),t.removeClass("ag-no-transition")});var c=m.clone();c.addClass("ag-no-transition ag-clone");var f,g=o.extend({},l);g.width=e+"px",c.css(g),h.append(c),f=$,b(c,{ignoreCheck:function(o){return!s(o).hasClass("img-loaded")},onFullLoad:function(){if(f<$)c.remove();else{var o,t,n,r=[];for(t=0,n=m.length;t<n;t++){o=s(m[t]);var l=m[t].offsetHeight,d=u.keepSort?a[t%i]:Math.min.apply(Math,a),g=u.keepSort?t%i:a.indexOf(d);a[g]=Math.max(a[g],d+l+v.gutterSize);var p=g*(e+v.gutterSize),S={position:"absolute",top:a[g]-l-v.gutterSize+"px"};"rtol"==v.direction?S.right=p+"px":S.left=p+"px",S.width=e+"px",r.push({top:d,bottom:d+l}),o.css(S).addClass("angular-grid-item")}var I=Math.max.apply(Math,a);h.css("height",I+"px"),c.remove(),(v.performantScroll||u.infiniteScroll)&&(w.scrollContInfo=L()),v.performantScroll&&(w.lastPage=null,function(o,t,n){w.pageInfo=[{from:0}];var e,i,r,a=v.pageSize,l=w.scrollContInfo.height*a,s=Math.ceil(t/l),d=0;for(d=0;d<s;d++)for(var c=0,f=o.length;c<f;c++)if(e=o[c],i=d?l*d:0,r=l*(d+1),e.bottom<i||e.top>r){if(e.top>r)break}else w.pageInfo[d]||(w.pageInfo[d]={from:c}),w.pageInfo[d].to=c;w.pageInfo=w.pageInfo.map(function(o,t){var n=Math.max(t-1,0),e=Math.min(t+1,w.pageInfo.length-1);return{from:w.pageInfo[n].from,to:w.pageInfo[e].to}})}(r,I),w.isBusy=!1,G(w.lastScrollPosition||0)),x()}}})}}}function M(){return r(d(h.children()).filter(function(o){return!s(o).hasClass("ag-clone")}))}function T(){w.isBusy=!0,e(function(){var o;m=M(),(o=d(m).filter(function(o){return s(o).hasClass("ng-leave")}),f(function(t){o.length?s(o[0]).one("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",function(){e(function(){m=M(),t()})}):t()})).then(function(){var o;o=!1,d(m).forEach(function(t){var n=r(t);n.find("img").length&&(n.addClass("img-loading"),b(n,{beforeLoad:function(o){s(o).addClass("img-loading")},isLoaded:function(o){s(o).removeClass("img-loading").addClass("img-loaded")},onLoad:function(t){!o&&v.refreshOnImgLoad&&(o=!0,e(function(){O(),o=!1},100)),s(t).removeClass("img-loading").addClass("img-loaded")},onFullLoad:function(){n.removeClass("img-loading").addClass("img-loaded")}}))}),e(function(){O()})})})}function k(){z(),m&&O()}setTimeout(function(){w.scrollContInfo=L(),w.scrollContInfo.$elm.on("scroll",_)},0),u.$watch("model",T,!0),u.$watch("options",k,!0),Object.keys(i).forEach(function(o){u[o]!==n&&u.$watch(o,k)});var E=I.offsetWidth;function N(){w.isBusy=!0;var o=I.offsetWidth;E!=o&&(E=o,S&&e.cancel(S),S=e(function(){v.performantScroll&&(h.children().detach(),h.append(m)),O()},100))}C.on("resize",N),y&&(g[y]={refresh:function(){T()},handleScroll:function(o){v.performantScroll&&G(o),u.infiniteScroll&&W(o)}}),u.$on("$destroy",function(){y&&delete g[y],C.off("resize",N),clearTimeout(w.infiniteScrollTimeout),w.scrollContInfo&&w.scrollContInfo.$elm.off("scroll",_)})}}}]).factory("angularGridInstance",function(){return{}}).name});