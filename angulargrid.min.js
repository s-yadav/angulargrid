/*
    angularGrid.js v 0.5.0
    Author: Sudhanshu Yadav
    Copyright (c) 2015 Sudhanshu Yadav - ignitersworld.com , released under the MIT license.
    Demo on: http://ignitersworld.com/lab/angulargrid/demo1.html
    Documentation and download on https://github.com/s-yadav/angulargrid
*/

!function(o,t,n){"use strict";function i(o){return o.complete&&("undefined"==typeof o.naturalWidth||0!==o.naturalWidth)}function e(o){return Array.prototype.slice.call(o)}var r={gridWidth:300,gutterSize:10,gridNo:"auto",direction:"ltor",refreshOnImgLoad:!0,cssGrid:!1,performantScroll:!1,pageSize:"auto",scrollContainer:"body",infiniteScrollDelay:3e3,infiniteScrollDistance:100},a=o.element,l=function(o){return o.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},s={visibility:"hidden",opacity:0,top:0,left:0,width:""},c=function(){var o=a(t);return function(t){return o[0]=t,o}}();a(document.head).append("<style>.ag-no-transition{-webkit-transition: none !important;transition: none !important;} .angular-grid{position : relative;} .angular-grid > *{opacity : 0} .angular-grid > .angular-grid-item{opacity : 1}</style>"),o.module("angularGrid",[]).directive("angularGrid",["$timeout","$window","$q","angularGridInstance",function(d,f,g,u){return{restrict:"A",scope:{model:"=angularGrid",dep_gridWidth:"=gridWidth",dep_gutterSize:"=gutterSize",dep_refreshOnImgLoad:"=refreshOnImgLoad",dep_direction:"=direction",dep_cssGrid:"=cssGrid",dep_options:"=angularGridOptions",dep_agId:"@angularGridId",gridWidth:"=agGridWidth",gutterSize:"=agGutterSize",refreshOnImgLoad:"=agRefreshOnImgLoad",direction:"=agDirection",cssGrid:"=agCssGrid",options:"=agOptions",agId:"@",pageSize:"=agPageSize",scrollContainer:"=agScrollContainer",infiniteScroll:"&agInfiniteScroll",infiniteScrollDistance:"=agInfiniteScrollDistance",infiniteScrollDelay:"=agInfiniteScrollDelay"},link:function(h,p,m){function v(){H={},Object.keys(r).forEach(function(o){h[o]!==n?H[o]=h[o]:h["dep_"+o]!==n&&(H[o]=h["dep_"+o])}),H=o.extend({},r,H,h.options||h.dep_options),H.cssGrid&&(H.gutterSize=0),"auto"==H.pageSize&&(H.pageSize=t.offsetWidth>=768?2:3)}function S(o,t){t=t||document.body;var n=0,i=0;if(o.offsetParent)do n+=o.offsetLeft,i+=o.offsetTop,o=o.offsetParent;while(o&&o!=t);return{left:n,top:i}}function I(){var o=a(document.querySelector(H.scrollContainer)),t=o[0];return{height:t.offsetHeight,scrollHeight:t.scrollHeight,startFrom:S(k,t).top,$elm:o,elm:t}}function C(o,t,n){N.pageInfo=[{from:0}];var i,e,r,a=H.pageSize,l=N.scrollContInfo.height,s=l*a,c=Math.ceil(t/s),d=0;for(d=0;c>d;d++)for(var f=0,g=o.length;g>f;f++)if(i=o[f],e=d?s*d:0,r=s*(d+1),i.bottom<e||i.top>r){if(i.top>r)break}else N.pageInfo[d]||(N.pageInfo[d]={from:f}),N.pageInfo[d].to=f;N.pageInfo=N.pageInfo.map(function(o,t){var n=Math.max(t-1,0),i=Math.min(t+1,N.pageInfo.length-1);return{from:N.pageInfo[n].from,to:N.pageInfo[i].to}})}function y(o){var t,n,i,e;for(i=0,e=E.length;e>i;i++)n=c(E[i]),t=n.data(),t.$scope&&(n.data("_agOldWatchers",t.$scope.$$watchers),t.$scope.$$watchers=[]);for(i=0,e=o.length;e>i;i++)t=c(o[i]).data(),t.$scope&&(t.$scope.$$watchers=t._agOldWatchers||[],t.$scope.$digest())}function w(o){N.lastScrollPosition=o;var t;if(!N.isBusy){var n=0,i=H.pageSize;if(o>N.scrollContInfo.startFrom+N.scrollContInfo.height*i&&(n=Math.floor((o-N.scrollContInfo.startFrom)/(N.scrollContInfo.height*i))),n!=N.lastPage){N.lastPage=n;var e=N.pageInfo[n];e&&(p.children().detach(),t=Array.prototype.slice.call(E,e.from,e.to),y(t),p.append(t))}}}function $(){clearTimeout(N.infiniteScrollTimeout),N.isLoading=!1}function z(o){if(!N.isLoading&&h.model.length){var t=N.scrollContInfo.scrollHeight,n=N.scrollContInfo.height;o>=t-n*(1+H.infiniteScrollDistance/100)&&(N.isLoading=!0,h.infiniteScroll(),N.infiniteScrollTimeout=setTimeout($,H.infiniteScrollDelay))}}function L(){H.performantScroll&&w(this.scrollTop),h.infiniteScroll&&z(this.scrollTop)}function G(){var o,t=k.offsetWidth;if(H.cssGrid){o=a(E[0]).clone(),o.css(s).addClass("ag-no-transition"),p.append(o);var n=o[0].offsetWidth;return o.remove(),{no:Math.floor((t+12)/n),width:n}}var i="auto"==H.gridNo?H.gridWidth:Math.floor(t/H.gridNo)-H.gutterSize,e="auto"==H.gridNo?Math.floor(t/(i+H.gutterSize)):H.gridNo,r=t%(i+H.gutterSize)+H.gutterSize;return i+=Math.floor(r/e),{no:e,width:i}}function W(t,n){var r=n.beforeLoad||o.noop,a=n.onLoad||o.noop,l=n.isLoaded||o.noop,s=n.onFullLoad||o.noop,c=n.ignoreCheck||o.noop,d=t.find("img"),f=[];e(d).forEach(function(o){r(o),i(o)||c(o)?l(o):f.push(g(function(t,n){o.onload=function(){a(o),t()},o.onerror=n}))}),f.length?g.all(f).then(s,s):setTimeout(function(){s()},0)}function O(){var t,n=G(),i=n.width,r=n.no,l=[];for(t=0;r>t;t++)l.push(0);e(E).forEach(function(o){var t=c(o);e(t.find("img")).forEach(function(o){var n=a(o);if(n.hasClass("img-loaded"))return void n.css("height","");t.addClass("ag-no-transition"),t.css("width",i+"px");var e=n.attr("actual-width")||n.attr("data-actual-width"),r=n.attr("actual-height")||n.attr("data-actual-height");e&&r&&n.css("height",r*o.width/e+"px")}),t.removeClass("ag-no-transition")});var d=E.clone();d.addClass("ag-no-transition");var f=o.extend({},s);f.width=i+"px",d.css(f),p.append(d),W(d,{ignoreCheck:function(o){return!c(o).hasClass("img-loaded")},onFullLoad:function(){var o,t,n,e=[],a=[];for(t=0,n=d.length;n>t;t++)e.push(d[t].offsetHeight);for(t=0,n=E.length;n>t;t++){o=c(E[t]);var s=e[t],f=Math.min.apply(Math,l),g=l.indexOf(f);l[g]=f+s+H.gutterSize;var u=g*(i+H.gutterSize),m={position:"absolute",top:f+"px"};"rtol"==H.direction?m.right=u+"px":m.left=u+"px",m.width=i+"px",a.push({top:f,bottom:f+s}),o.css(m).addClass("angular-grid-item")}var v=Math.max.apply(Math,l);p.css("height",v+"px"),d.remove(),(H.performantScroll||h.infiniteScroll)&&(N.scrollContInfo=I()),H.performantScroll&&(N.lastPage=null,C(a,v,r),N.isBusy=!1,w(N.lastScrollPosition||0)),$()}})}function T(){var o=!1;e(E).forEach(function(t){var n=a(t),i=n.find("img");i.length&&(n.addClass("img-loading"),W(n,{beforeLoad:function(o){c(o).addClass("img-loading")},isLoaded:function(o){c(o).removeClass("img-loading").addClass("img-loaded")},onLoad:function(t){!o&&H.refreshOnImgLoad&&(o=!0,d(function(){O(),o=!1},100)),c(t).removeClass("img-loading").addClass("img-loaded")},onFullLoad:function(){n.removeClass("img-loading").addClass("img-loaded")}}))})}function _(){var o=e(E).filter(function(o){return c(o).hasClass("ng-leave")});return g(function(t){o.length?c(o[0]).one("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",function(){d(function(){E=p.children(),t()})}):t()})}function b(){N.isBusy=!0,d(function(){E=p.children(),_().then(function(){T(),d(function(){O()})})})}function x(){v(),E&&O()}function M(){N.isBusy=!0;var o=k.offsetWidth;A!=o&&(A=o,D&&d.cancel(D),D=d(function(){H.performantScroll&&(p.children().detach(),p.append(E)),O()},100))}var E,D,k=p[0],P=a(f),F=h.agId||h.dep_agId;p.addClass("angular-grid");var H;["gridWidth","gutterSize","refreshOnImgLoad","direction","options","cssGrid","agId"].forEach(function(o){var t=l(o),i="ag-"+l(o);"options"==o&&(t="angular-grid-options"),"agId"==o&&(t="angular-grid-id",i="ag-id"),h["dep_"+o]!==n&&console&&console.warn&&console.warn(t+" is deprecated. Use "+i+" instead in template.")}),v();var N={};setTimeout(function(){N.scrollContInfo=I(),N.scrollContInfo.$elm.on("scroll",L)},0),h.$watch("model",b,!0),h.$watch("options",x,!0),Object.keys(r).forEach(function(o){h[o]!==n&&h.$watch(o,x)});var A=k.offsetWidth;P.on("resize",M),F&&(u[F]={refresh:function(){b()},scroll:function(o){H.performantScroll&&w(o),h.infiniteScroll&&z(o)}}),h.$on("$destroy",function(){F&&delete u[F],P.off("resize",M),clearTimeout(N.infiniteScrollTimeout),N.scrollContInfo&&N.scrollContInfo.$elm.off("scroll",L)})}}}]).factory("angularGridInstance",function(){var o={};return o})}(angular,window);
